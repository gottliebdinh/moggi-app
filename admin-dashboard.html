<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moggi Admin Dashboard - Reservierungen</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #242424;
            color: #E5E5E5;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1A1A1A 0%, #242424 100%);
            color: white;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 32px;
            font-weight: 300;
            margin-bottom: 8px;
            font-family: Georgia, serif;
        }

        .header .divider {
            width: 60px;
            height: 3px;
            background: #FF6B00;
            margin-bottom: 16px;
            border-radius: 2px;
        }

        .header p {
            color: #E5E5E5;
            font-size: 16px;
        }

        /* Navigation */
        .nav {
            background: #1A1A1A;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            border: 1px solid #333333;
        }

        .nav-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: #333333;
            color: #E5E5E5;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .nav-btn:hover {
            background: #FF6B00;
        }

        .nav-btn.active {
            background: #FF6B00;
        }

        /* Day Switcher */
        .day-switcher {
            background: #1A1A1A;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            border: 1px solid #333333;
        }

        .day-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .day-btn {
            background: #FF6B00;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .day-btn:hover {
            background: #CC5500;
            transform: translateY(-2px);
        }


        .calendar-btn-modern {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .calendar-btn-modern:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .calendar-btn-modern svg {
            width: 16px;
            height: 16px;
        }

        /* Date Picker Dropdown */
        .date-picker-dropdown {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1A1A1A;
            border: 1px solid #333333;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            margin-top: 8px;
            display: none;
        }

        .date-picker-content {
            padding: 20px;
            min-width: 280px;
        }

        .date-picker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .date-picker-nav {
            background: #333333;
            border: none;
            color: #E5E5E5;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: background-color 0.3s ease;
        }

        .date-picker-nav:hover {
            background: #FF6B00;
        }

        #currentMonthYear {
            color: #E5E5E5;
            font-weight: 600;
            font-size: 16px;
        }

        .date-picker-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 16px;
        }

        .date-picker-day-header {
            text-align: center;
            color: #999999;
            font-size: 12px;
            font-weight: 600;
            padding: 8px 4px;
            text-transform: uppercase;
        }

        .date-picker-day {
            background: #333333;
            border: none;
            color: #E5E5E5;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            min-height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .date-picker-day:hover {
            background: #FF6B00;
        }

        .date-picker-day.other-month {
            color: #666666;
        }

        .date-picker-day.today {
            background: #FF6B00;
            color: white;
        }

        .date-picker-day.selected {
            background: #CC5500;
            color: white;
        }

        .date-picker-footer {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .date-picker-btn {
            background: #333333;
            border: none;
            color: #E5E5E5;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .date-picker-btn:hover {
            background: #FF6B00;
        }

        .current-day {
            background: #FF6B00;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }

        .stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #FF6B00;
        }

        .stat-label {
            font-size: 12px;
            color: #E5E5E5;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .add-reservation-section {
            display: flex;
            align-items: center;
        }

        .add-reservation-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .add-reservation-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
        }

        .add-reservation-btn svg {
            width: 20px;
            height: 20px;
        }

        /* Table */
        .table-container {
            background: #1A1A1A;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
            border: 1px solid #333333;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: #1A1A1A;
            color: white;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table td {
            padding: 16px 12px;
            border-bottom: 1px solid #333333;
            font-size: 14px;
            color: #E5E5E5;
        }

        .table tr:hover {
            background: #333333;
        }

        .table tr.clickable {
            cursor: pointer;
        }

        .table tr.clickable:hover {
            background: #333333;
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        /* Source Icons */
        .source-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: help;
        }

        .source-icon .icon {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .source-handy {
            color: #4CAF50;
        }

        .source-web {
            color: #2196F3;
        }

        .source-manual {
            color: #FF9800;
        }

        .table tr.cancelled {
            opacity: 0.6;
        }

        .table tr.cancelled td {
            text-decoration: line-through;
            color: #999999;
        }

        .table tr.cancelled .status-select {
            text-decoration: none;
        }

        /* Status Dropdown */
        .status-dropdown {
            position: relative;
            display: inline-block;
        }

        .status-select {
            background: white;
            border: 2px solid #E5E5E5;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            min-width: 120px;
            transition: all 0.3s ease;
        }

        .status-select:focus {
            outline: none;
            border-color: #FF6B00;
            box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.1);
        }

        .status-select.status-no-show {
            background: #FFF3E0;
            border-color: #FFB74D;
            color: #E65100;
        }

        .status-select.status-placed {
            background: #E8F5E8;
            border-color: #4CAF50;
            color: #2E7D32;
        }

        .status-select.status-cancelled {
            background: #FFEBEE;
            border-color: #F44336;
            color: #C62828;
        }

        /* Comment Button */
        .email-btn {
            background: #FF6B00;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            box-shadow: 0 2px 8px rgba(255, 107, 0, 0.3);
        }

        .email-btn:hover {
            background: #E55A00;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 0, 0.4);
        }

        .email-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(255, 107, 0, 0.3);
        }

        .email-btn svg {
            transition: transform 0.2s ease;
        }

        .email-btn:hover svg {
            transform: scale(1.1);
        }

        .comment-btn {
            background: #FF6B00;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .comment-btn:hover {
            background: #CC5500;
            transform: translateY(-1px);
        }

        .comment-btn.has-comment {
            background: #1A1A1A;
        }

        .comment-btn.has-comment:hover {
            background: #333333;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #1A1A1A;
            margin: 5% auto;
            padding: 30px;
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid #333333;
        }

        .modal-content.large {
            max-width: 1000px;
            max-height: 95vh;
            margin: 2.5vh auto;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #E5E5E5;
            font-size: 20px;
            font-weight: 600;
        }

        .close {
            color: #E5E5E5;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #FF6B00;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #E5E5E5;
        }

        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #333333;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            min-height: 100px;
            transition: border-color 0.3s ease;
            background: #242424;
            color: #E5E5E5;
        }

        .form-group textarea:focus {
            outline: none;
            border-color: #FF6B00;
            box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.1);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #FF6B00;
            color: white;
        }

        .btn-primary:hover {
            background: #CC5500;
        }

        .btn-secondary {
            background: #E5E5E5;
            color: #666666;
        }

        .btn-secondary:hover {
            background: #CCCCCC;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .nav-buttons {
                flex-direction: column;
            }

            .day-switcher {
                flex-direction: column;
                align-items: stretch;
            }

            .day-nav {
                justify-content: center;
            }

            .stats {
                justify-content: center;
            }

            .table-container {
                overflow-x: auto;
            }

            .table {
                min-width: 800px;
            }

            .modal-content {
                margin: 5% auto;
                width: 95%;
                padding: 20px;
            }
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666666;
        }

        .spinner {
            border: 3px solid #E5E5E5;
            border-top: 3px solid #FF6B00;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Reservation Detail Modal */
        .reservation-detail {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 15px;
            flex: 1;
            min-height: 0;
        }

        .top-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .reservation-info {
            background: #333333;
            padding: 15px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            min-height: 0;
            border: 1px solid #444444;
        }

        .reservation-info h4 {
            color: #E5E5E5;
            margin-bottom: 16px;
            font-size: 18px;
            font-weight: 600;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-item label {
            font-size: 12px;
            color: #E5E5E5;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .info-item select,
        .info-item input {
            padding: 8px 12px;
            border: 2px solid #333333;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: #242424;
            color: #E5E5E5;
        }

        .info-item select:focus,
        .info-item input:focus {
            outline: none;
            border-color: #FF6B00;
        }

        .info-item.full-width {
            grid-column: 1 / -1;
        }

        .info-item textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #555555;
            border-radius: 6px;
            background: #2A2A2A;
            color: #E5E5E5;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
            transition: border-color 0.3s ease;
        }

        .info-item textarea:focus {
            outline: none;
            border-color: #FF6B00;
            box-shadow: 0 0 0 2px rgba(255, 107, 0, 0.2);
        }

        .info-item textarea::placeholder {
            color: #888888;
        }

        .date-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .date-input-wrapper input {
            flex: 1;
            padding-right: 40px;
        }

        .calendar-btn {
            position: absolute;
            right: 8px;
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.3s ease;
            z-index: 10;
        }

        .calendar-btn:hover {
            background: rgba(255, 107, 0, 0.1);
        }

        .tables-section {
            background: #333333;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #444444;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .tables-section h4 {
            color: #E5E5E5;
            margin-bottom: 16px;
            font-size: 18px;
            font-weight: 600;
        }

        .table-recommendation {
            background: #FFF3E0;
            border: 1px solid #FFB74D;
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 12px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .table-recommendation.perfect {
            background: #E8F5E8;
            border-color: #4CAF50;
            color: #2E7D32;
        }

        .table-recommendation.warning {
            background: #FFF3E0;
            border-color: #FFB74D;
            color: #E65100;
        }

        .table-recommendation.error {
            background: #FFEBEE;
            border-color: #F44336;
            color: #C62828;
        }

        .recommendation-icon {
            font-size: 16px;
            flex-shrink: 0;
        }

        .recommendation-text {
            flex: 1;
            font-weight: 500;
        }

        .tables-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px;
            margin-top: 8px;
            flex: 1;
            overflow-y: auto;
        }

        .table-option {
            border: 2px solid #E5E5E5;
            border-radius: 6px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            color: #1A1A1A;
        }

        .table-option:hover {
            border-color: #FF6B00;
            background: #FFF3E0;
            color: #1A1A1A;
        }

        .table-option.selected {
            border-color: #FF6B00;
            background: #FF6B00;
            color: white;
        }

        .table-option.disabled {
            background: #F5F5F5;
            color: #999999;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .table-option.disabled:hover {
            border-color: #E5E5E5;
            background: #F5F5F5;
        }

        .table-name {
            font-weight: 600;
            font-size: 12px;
            margin-bottom: 2px;
        }

        .table-capacity {
            font-size: 12px;
            font-weight: 600;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #FF6B00;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 4px auto;
        }

        .guest-details {
            background: #333333;
            padding: 15px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            min-height: 0;
            border: 1px solid #444444;
        }

        .guest-details h4 {
            color: #E5E5E5;
            margin-bottom: 16px;
            font-size: 18px;
            font-weight: 600;
        }

        .guest-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
            min-height: 0;
        }

        .guest-form .form-group {
            margin-bottom: 0;
        }

        .guest-form label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #E5E5E5;
            font-size: 14px;
        }

        .guest-form input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #333333;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: #242424;
            color: #E5E5E5;
        }

        .guest-form input:focus {
            outline: none;
            border-color: #FF6B00;
        }


        .reservation-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #333333;
            flex-shrink: 0;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .btn-danger {
            background: #F44336;
            color: white;
        }

        .btn-danger:hover {
            background: #da190b;
        }

        /* Mobile Responsive for Detail Modal */
        @media (max-width: 768px) {
            .modal-content.large {
                margin: 1vh auto;
                max-height: 98vh;
            }

            .reservation-detail {
                gap: 15px;
            }

            .top-section {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .info-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .tables-grid {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
                gap: 6px;
            }

            .reservation-actions {
                flex-direction: column;
            }

            .reservation-actions .btn {
                width: 100%;
            }

            .reservation-info,
            .guest-details {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Moggi Admin Dashboard</h1>
            <div class="divider"></div>
            <p>Reservierungen verwalten und √ºberwachen</p>
        </div>

        <!-- Navigation -->
        <div class="nav">
            <div class="nav-buttons">
                <a href="orders-dashboard.html" class="nav-btn">üçΩÔ∏è Bestellungen</a>
                <a href="#" class="nav-btn active">üìä Reservierungen</a>
                <a href="tischplan-settings.html" class="nav-btn">ü™ë Tischplan</a>
                <a href="capacity-settings.html" class="nav-btn">‚öôÔ∏è Kapazit√§t</a>
            </div>
        </div>

        <!-- Day Switcher -->
        <div class="day-switcher">
            <div class="day-nav">
                <button class="day-btn" onclick="changeDay(-1)">‚Üê Vorheriger</button>
                <div class="current-day" id="currentDay">
                    <span>Heute, 15. Januar 2024</span>
                    <button class="calendar-btn-modern" onclick="toggleDatePicker()" title="Datum ausw√§hlen">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </button>
                    
                    <!-- Date Picker Dropdown -->
                    <div id="datePickerDropdown" class="date-picker-dropdown">
                        <div class="date-picker-content">
                            <div class="date-picker-header">
                                <button class="date-picker-nav" onclick="changeMonth(-1)">‚Äπ</button>
                                <span id="currentMonthYear">Januar 2024</span>
                                <button class="date-picker-nav" onclick="changeMonth(1)">‚Ä∫</button>
                            </div>
                            <div class="date-picker-calendar" id="datePickerCalendar">
                                <!-- Calendar will be populated dynamically -->
                            </div>
                            <div class="date-picker-footer">
                                <button class="date-picker-btn" onclick="goToToday()">Heute</button>
                                <button class="date-picker-btn" onclick="closeDatePicker()">Schlie√üen</button>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="day-btn" onclick="changeDay(1)">N√§chster ‚Üí</button>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalReservations">12</div>
                    <div class="stat-label">Reservierungen</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="totalGuests">28</div>
                    <div class="stat-label">G√§ste</div>
                </div>
                <div class="add-reservation-section">
                    <button class="add-reservation-btn" onclick="openAddReservation()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Reservierung hinzuf√ºgen
                    </button>
                </div>
            </div>
        </div>

        <!-- Reservations Table -->
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Typ</th>
                        <th>Zeit</th>
                        <th>Gastname</th>
                        <th>Anz.</th>
                        <th>Tische</th>
                        <th>Notiz</th>
                        <th>Antwort</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="reservationsTable">
                    <!-- Data will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>


    <!-- Comment Modal -->
    <div id="commentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Kommentar hinzuf√ºgen</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="form-group">
                <label for="commentText">Kommentar:</label>
                <textarea id="commentText" placeholder="Kommentar eingeben..."></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button>
                <button class="btn btn-primary" onclick="saveComment()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Reservation Detail Modal -->
    <div id="reservationDetailModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>Reservierung bearbeiten</h3>
                <span class="close" onclick="closeReservationModal()">&times;</span>
            </div>
            
            <div class="reservation-detail">
                <!-- Top section: Reservation Details and Guest Details side by side -->
                <div class="top-section">
                    <!-- Left side: Reservation Info -->
                    <div class="reservation-info">
                        <h4>Reservierungsdetails</h4>
                        
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Datum</label>
                                <input type="date" id="reservationDate" />
                            </div>
                            <div class="info-item">
                                <label>Gruppengr√∂√üe</label>
                                <input type="number" id="groupSize" min="1" max="50" value="2" placeholder="Anzahl Personen">
                            </div>
                            <div class="info-item">
                                <label>Aufenthaltsdauer</label>
                                <select id="duration">
                                    <option value="60">1 Stunde</option>
                                    <option value="90">1,5 Stunden</option>
                                    <option value="120">2 Stunden</option>
                                    <option value="150">2,5 Stunden</option>
                                    <option value="180">3 Stunden</option>
                                    <option value="240">4+ Stunden</option>
                                </select>
                            </div>
                            <div class="info-item">
                                <label>Verf√ºgbare Zeit</label>
                                <select id="availableTime">
                                    <option value="12:00">12:00</option>
                                    <option value="12:30">12:30</option>
                                    <option value="13:00">13:00</option>
                                    <option value="13:30">13:30</option>
                                    <option value="14:00">14:00</option>
                                    <option value="18:00">18:00</option>
                                    <option value="18:30">18:30</option>
                                    <option value="19:00">19:00</option>
                                    <option value="19:30">19:30</option>
                                    <option value="20:00">20:00</option>
                                    <option value="20:30">20:30</option>
                                    <option value="21:00">21:00</option>
                                </select>
                            </div>
                            <div class="info-item full-width">
                                <label>Kommentar</label>
                                <textarea id="reservationComment" placeholder="Kommentar zur Reservierung..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Right side: Guest Details -->
                    <div class="guest-details">
                        <h4>Gastdetails</h4>
                        <div class="guest-form">
                            <div class="form-group">
                                <label for="guestName">Name</label>
                                <input type="text" id="guestName" placeholder="Vor- und Nachname" />
                            </div>
                            <div class="form-group">
                                <label for="guestPhone">Telefonnummer</label>
                                <input type="tel" id="guestPhone" placeholder="+49 123 456789" />
                            </div>
                            <div class="form-group">
                                <label for="guestEmail">E-Mail</label>
                                <input type="email" id="guestEmail" placeholder="gast@beispiel.de" />
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bottom section: Available Tables -->
                <div class="tables-section">
                    <h4>Verf√ºgbare Tische</h4>
                    <div class="table-recommendation" id="tableRecommendation">
                        <!-- Table recommendation will be shown here -->
                    </div>
                    <div class="tables-grid" id="tablesGrid">
                        <!-- Tables will be populated dynamically -->
                    </div>
                </div>
            </div>

            <div class="reservation-actions">
                <button class="btn btn-secondary" onclick="closeReservationModal()">Abbrechen</button>
                <button class="btn btn-success" onclick="saveReservation()">Speichern</button>
            </div>
        </div>
    </div>

    <script>
        // Clear old table data to load new Moggi tables
        localStorage.removeItem('moggiRooms');
        localStorage.removeItem('moggiNextRoomId');
        localStorage.removeItem('moggiNextTableId');
        
        // Sample data
        const reservationsData = [
            {
                id: 1,
                type: 'Abendessen',
                source: 'handy',
                time: '19:30',
                guestName: 'M√ºller, Familie',
                guests: 4,
                tables: 'Tisch 5',
                note: 'Hochzeitstag',
                comment: '',
                status: 'placed',
                date: '2024-01-15',
                duration: 120,
                phone: '+49 911 123456',
                email: 'mueller@beispiel.de'
            },
            {
                id: 2,
                type: 'Mittagessen',
                source: 'web',
                time: '13:00',
                guestName: 'Schmidt, Herr',
                guests: 2,
                tables: 'Tisch 2',
                note: 'Vegetarisch',
                comment: 'Sehr zufrieden mit dem Service',
                status: 'placed',
                date: '2024-01-15',
                duration: 90,
                phone: '+49 911 234567',
                email: 'schmidt@beispiel.de'
            },
            {
                id: 3,
                type: 'Abendessen',
                source: 'manual',
                time: '20:00',
                guestName: 'Weber, Frau',
                guests: 6,
                tables: 'Tisch 8, 9',
                note: 'Geburtstag',
                comment: '',
                status: 'no-show',
                date: '2024-01-15',
                duration: 180,
                phone: '+49 911 345678',
                email: 'weber@beispiel.de'
            },
            {
                id: 4,
                type: 'Mittagessen',
                source: 'handy',
                time: '12:30',
                guestName: 'Klein, Familie',
                guests: 3,
                tables: 'Tisch 3',
                note: 'Allergien: N√ºsse',
                comment: 'Allergien wurden ber√ºcksichtigt',
                status: 'placed',
                date: '2024-01-15',
                duration: 90,
                phone: '+49 911 456789',
                email: 'klein@beispiel.de'
            },
            {
                id: 5,
                type: 'Abendessen',
                source: 'web',
                time: '18:45',
                guestName: 'Hoffmann, Herr',
                guests: 2,
                tables: 'Tisch 1',
                note: '',
                comment: '',
                status: 'cancelled',
                date: '2024-01-15',
                duration: 120,
                phone: '+49 911 567890',
                email: 'hoffmann@beispiel.de'
            },
            {
                id: 6,
                time: '19:00',
                guestName: 'Max Mustermann',
                guests: 4,
                tables: '',
                note: 'Neue Reservierung',
                comment: '',
                status: 'placed',
                date: '2024-01-15',
                duration: 120,
                source: 'web',
                phone: '+49 911 999888',
                email: 'max@beispiel.de'
            }
        ];

        // Calculate table availability based on time conflicts
        function calculateTableAvailability(selectedTime, selectedDuration, excludeReservationId = null) {
            const tables = loadAvailableTables();
            const selectedDate = document.getElementById('reservationDate').value;
            
            // Convert time to minutes for easier comparison
            function timeToMinutes(timeStr) {
                const [hours, minutes] = timeStr.split(':').map(Number);
                return hours * 60 + minutes;
            }
            
            // Convert minutes back to time string
            function minutesToTime(minutes) {
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;
                return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
            }
            
            const selectedStartMinutes = timeToMinutes(selectedTime);
            const selectedEndMinutes = selectedStartMinutes + selectedDuration;
            
            // Check each table for conflicts
            tables.forEach(table => {
                table.available = true;
                
                // Check against existing reservations
                reservationsData.forEach(reservation => {
                    // Skip the current reservation being edited
                    if (reservation.id === excludeReservationId) {
                        return;
                    }
                    
                    if (reservation.date === selectedDate && 
                        reservation.status !== 'cancelled' && 
                        reservation.tables && 
                        reservation.tables.includes(table.name.split(' (')[0])) {
                        
                        const reservationStartMinutes = timeToMinutes(reservation.time);
                        const reservationEndMinutes = reservationStartMinutes + (reservation.duration || 120);
                        
                        // Check for time overlap
                        if (!(selectedEndMinutes <= reservationStartMinutes || selectedStartMinutes >= reservationEndMinutes)) {
                            table.available = false;
                        }
                    }
                });
            });
            
            return tables;
        }

        // Load available tables from localStorage or use default
        function loadAvailableTables() {
            const savedRooms = JSON.parse(localStorage.getItem('moggiRooms'));
            if (savedRooms && savedRooms.length > 0) {
                const tables = [];
                savedRooms.forEach(room => {
                    room.tables.forEach(table => {
                        tables.push({
                            id: table.id,
                            name: `${table.name} (${room.name})`,
                            capacity: table.capacity,
                            available: true
                        });
                    });
                });
                return tables;
            }
            
            // Default tables if no saved data
            return [
                // Galerie - 2 Pl√§tze
                { id: 61, name: '61 Galerie oben', capacity: 2, available: true },
                { id: 51, name: '51 Galerie oben', capacity: 2, available: true },
                { id: 58, name: '58 Galerie oben', capacity: 2, available: true },
                { id: 60, name: '60 Galerie oben', capacity: 2, available: true },
                
                // Galerie - 3 Pl√§tze
                { id: 50, name: '50 Galerie oben', capacity: 3, available: true },
                { id: 62, name: '62 Galerie oben', capacity: 3, available: true },
                
                // Galerie - 4 Pl√§tze
                { id: 57, name: '57 Galerie oben', capacity: 4, available: true },
                { id: 53, name: '53 Galerie oben', capacity: 4, available: true },
                { id: 54, name: '54 Galerie oben', capacity: 4, available: true },
                { id: 55, name: '55 Galerie oben', capacity: 4, available: true },
                { id: 56, name: '56 Galerie oben', capacity: 4, available: true },
                { id: 59, name: '59 Galerie oben', capacity: 4, available: true },
                
                // Unten - 2 Pl√§tze
                { id: 1, name: '1 Tisch', capacity: 2, available: true },
                { id: 7, name: '7 Tisch', capacity: 2, available: true },
                { id: 26, name: '26 Tisch', capacity: 2, available: true },
                { id: 27, name: '27 Tisch', capacity: 2, available: true },
                { id: 23, name: '23 Tisch', capacity: 2, available: true },
                { id: 22, name: '22 Tisch', capacity: 2, available: true },
                { id: 25, name: '25 Tisch', capacity: 2, available: true },
                { id: 18, name: '18 Tisch', capacity: 2, available: true },
                { id: 19, name: '19 Tisch', capacity: 2, available: true },
                { id: 28, name: '28 Tisch', capacity: 2, available: true },
                { id: 24, name: '24 Tisch', capacity: 2, available: true },
                
                // Unten - 3 Pl√§tze
                { id: 30, name: '30 Tisch', capacity: 3, available: true },
                { id: 31, name: '31 Tisch', capacity: 3, available: true },
                
                // Unten - 4 Pl√§tze
                { id: 17, name: '17 Tisch', capacity: 4, available: true },
                { id: 2, name: '2 Tisch', capacity: 4, available: true },
                { id: 3, name: '3 Tisch', capacity: 4, available: true },
                { id: 4, name: '4 Tisch', capacity: 4, available: true },
                { id: 5, name: '5 Tisch', capacity: 4, available: true },
                { id: 6, name: '6 Tisch', capacity: 4, available: true },
                
                // Unten - 6 Pl√§tze
                { id: 20, name: '20 Tisch', capacity: 6, available: true },
                { id: 21, name: '21 Tisch', capacity: 6, available: true }
            ];
        }

        let availableTables = loadAvailableTables();

        let currentDate = new Date();
        let currentReservationId = null;

        // Get source information
        function getSourceInfo(source) {
            const sourceMap = {
                'handy': {
                    icon: 'üì±',
                    text: 'Handy App'
                },
                'web': {
                    icon: 'üåê',
                    text: 'Website'
                },
                'manual': {
                    icon: '‚úã',
                    text: 'Manuell'
                }
            };
            return sourceMap[source] || { icon: '‚úã', text: 'Manuell' };
        }

        // Initialize the dashboard
        function initDashboard() {
            updateDateDisplay();
            renderReservations();
            updateStats();
        }

        // Update date display
        function updateDateDisplay() {
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            const dateString = currentDate.toLocaleDateString('de-DE', options);
            const currentDayElement = document.getElementById('currentDay');
            const spanElement = currentDayElement.querySelector('span');
            if (spanElement) {
                spanElement.textContent = dateString;
            } else {
                currentDayElement.textContent = dateString;
            }
        }

        // Change day
        function changeDay(direction) {
            currentDate.setDate(currentDate.getDate() + direction);
            updateDateDisplay();
            renderReservations();
            updateStats();
        }

        // Update statistics
        function updateStats() {
            const totalReservations = reservationsData.length;
            const totalGuests = reservationsData.reduce((sum, res) => sum + res.guests, 0);
            
            document.getElementById('totalReservations').textContent = totalReservations;
            document.getElementById('totalGuests').textContent = totalGuests;
        }

        // Render reservations table
        function renderReservations() {
            const tbody = document.getElementById('reservationsTable');
            tbody.innerHTML = '';

            reservationsData.forEach(reservation => {
                const row = document.createElement('tr');
                row.className = `clickable ${reservation.status === 'cancelled' ? 'cancelled' : ''}`;
                row.onclick = () => openReservationDetail(reservation.id);
                // Get source info directly
                let sourceIcon, sourceText;
                switch(reservation.source) {
                    case 'handy':
                        sourceIcon = 'üì±';
                        sourceText = 'Handy App';
                        break;
                    case 'web':
                        sourceIcon = 'üåê';
                        sourceText = 'Website';
                        break;
                    case 'manual':
                    default:
                        sourceIcon = '‚úã';
                        sourceText = 'Manuell';
                        break;
                }
                
                row.innerHTML = `
                    <td>
                        <div class="source-icon source-${reservation.source || 'manual'}" title="${sourceText}">
                            <span class="icon">${sourceIcon}</span>
                        </div>
                    </td>
                    <td>${reservation.time}</td>
                    <td>${reservation.guestName}</td>
                    <td>${reservation.guests}</td>
                    <td>${reservation.tables ? reservation.tables : '<span style="color: #FF6B00; font-weight: bold; font-size: 18px;">!</span>'}</td>
                    <td>${reservation.note}</td>
                    <td>
                        <button class="email-btn" 
                                onclick="event.stopPropagation(); sendEmailToCustomer(${reservation.id})"
                                title="E-Mail an Kunden senden">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M20 4H4C2.9 4 2.01 4.9 2.01 6L2 18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM20 8L12 13L4 8V6L12 11L20 6V8Z" fill="currentColor"/>
                            </svg>
                        </button>
                    </td>
                    <td>
                        <select class="status-select status-${reservation.status}" 
                                onchange="updateStatus(${reservation.id}, this.value)"
                                onclick="event.stopPropagation()">
                            <option value="placed" ${reservation.status === 'placed' ? 'selected' : ''}>Platziert</option>
                            <option value="no-show" ${reservation.status === 'no-show' ? 'selected' : ''}>No-Show</option>
                            <option value="cancelled" ${reservation.status === 'cancelled' ? 'selected' : ''}>Storniert</option>
                        </select>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update status
        function updateStatus(reservationId, newStatus) {
            const reservation = reservationsData.find(r => r.id === reservationId);
            if (reservation) {
                const oldStatus = reservation.status;
                reservation.status = newStatus;
                
                // Update the select element's class
                const selectElement = event.target;
                selectElement.className = `status-select status-${newStatus}`;
                
                // Handle table availability
                if (newStatus === 'cancelled') {
                    // Free up tables when cancelled
                    freeUpTables(reservation.tables);
                } else if (oldStatus === 'cancelled' && newStatus !== 'cancelled') {
                    // Reserve tables again when un-cancelled
                    reserveTables(reservation.tables);
                }
                
                // Re-render to update visual state
                renderReservations();
            }
        }

        // Free up tables (make them available)
        function freeUpTables(tableNames) {
            if (!tableNames) return;
            
            const tables = tableNames.split(', ').map(name => name.trim());
            tables.forEach(tableName => {
                const table = availableTables.find(t => t.name === tableName);
                if (table) {
                    table.available = true;
                }
            });
        }

        // Reserve tables (make them unavailable)
        function reserveTables(tableNames) {
            if (!tableNames) return;
            
            const tables = tableNames.split(', ').map(name => name.trim());
            tables.forEach(tableName => {
                const table = availableTables.find(t => t.name === tableName);
                if (table) {
                    table.available = false;
                }
            });
        }

        // Send email to customer
        function sendEmailToCustomer(reservationId) {
            const reservation = reservationsData.find(r => r.id === reservationId);
            if (!reservation) return;
            
            if (!reservation.email) {
                alert('Keine E-Mail-Adresse f√ºr diesen Gast hinterlegt.');
                return;
            }
            
            // Create email subject and body
            const subject = `Reservierung bei Moggi - ${reservation.date}`;
            const body = `Hallo ${reservation.guestName},

vielen Dank f√ºr Ihre Reservierung bei Moggi!

Reservierungsdetails:
- Datum: ${reservation.date}
- Uhrzeit: ${reservation.time}
- Anzahl Personen: ${reservation.guests}
- Tische: ${reservation.tables || 'Noch nicht zugewiesen'}

${reservation.note ? `Notiz: ${reservation.note}` : ''}

Wir freuen uns auf Ihren Besuch!

Mit freundlichen Gr√º√üen
Ihr Moggi-Team`;

            // Create mailto link
            const mailtoLink = `mailto:${reservation.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // Open email client
            window.open(mailtoLink);
        }

        // Open comment modal
        function openCommentModal(reservationId) {
            currentReservationId = reservationId;
            const reservation = reservationsData.find(r => r.id === reservationId);
            document.getElementById('commentText').value = reservation.comment || '';
            document.getElementById('commentModal').style.display = 'block';
        }


        // Close modal
        function closeModal() {
            document.getElementById('commentModal').style.display = 'none';
            currentReservationId = null;
        }

        // Save comment
        function saveComment() {
            if (currentReservationId) {
                const reservation = reservationsData.find(r => r.id === currentReservationId);
                if (reservation) {
                    reservation.comment = document.getElementById('commentText').value;
                    renderReservations(); // Re-render to update button state
                }
            }
            closeModal();
        }

        // Open reservation detail modal
        function openReservationDetail(reservationId) {
            currentReservationId = reservationId;
            const reservation = reservationsData.find(r => r.id === reservationId);
            
            if (reservation) {
                // Populate form fields
                document.getElementById('reservationDate').value = reservation.date || '';
                document.getElementById('groupSize').value = reservation.guests || 2;
                document.getElementById('duration').value = reservation.duration || 120;
                document.getElementById('availableTime').value = reservation.time || '19:00';
                document.getElementById('guestName').value = reservation.guestName || '';
                document.getElementById('guestPhone').value = reservation.phone || '';
                document.getElementById('guestEmail').value = reservation.email || '';
                document.getElementById('reservationComment').value = reservation.comment || '';
                
                // Populate tables
                populateTables(reservation.tables);
                
                // Show modal
                document.getElementById('reservationDetailModal').style.display = 'block';
            }
        }

        // Populate available tables
        function populateTables(selectedTables) {
            const tablesGrid = document.getElementById('tablesGrid');
            tablesGrid.innerHTML = '';
            
            // Get current time and duration from form
            const currentTime = document.getElementById('availableTime').value || '19:00';
            const currentDuration = parseInt(document.getElementById('duration').value) || 120;
            
            // Calculate availability based on time conflicts, excluding current reservation
            const tables = calculateTableAvailability(currentTime, currentDuration, currentReservationId);
            
            tables.forEach(table => {
                // Only show available tables, or tables that are already selected for this reservation
                const isSelectedForCurrentReservation = selectedTables && selectedTables.includes(table.name);
                
                if (!table.available && !isSelectedForCurrentReservation) {
                    return; // Skip this table - it's not available and not selected
                }
                
                const tableElement = document.createElement('div');
                tableElement.className = `table-option ${!table.available ? 'disabled' : ''}`;
                if (isSelectedForCurrentReservation) {
                    tableElement.classList.add('selected');
                }
                
                tableElement.innerHTML = `
                    <div class="table-name">${table.name}</div>
                    <div class="table-capacity">${table.capacity}</div>
                `;
                
                // Always allow clicking on tables (available or selected)
                tableElement.onclick = () => {
                    toggleTableSelection(tableElement, table.id);
                    updateTableRecommendation();
                };
                
                tablesGrid.appendChild(tableElement);
            });
            
            // Add event listeners to group size, duration, and time changes
            document.getElementById('groupSize').addEventListener('change', updateTableRecommendation);
            document.getElementById('duration').addEventListener('change', () => {
                const selectedTables = Array.from(document.querySelectorAll('.table-option.selected'))
                    .map(el => el.querySelector('.table-name').textContent);
                populateTables(selectedTables);
                updateTableRecommendation();
            });
            document.getElementById('availableTime').addEventListener('change', () => {
                const selectedTables = Array.from(document.querySelectorAll('.table-option.selected'))
                    .map(el => el.querySelector('.table-name').textContent);
                populateTables(selectedTables);
                updateTableRecommendation();
            });
            
            // Initial recommendation
            updateTableRecommendation();
        }

        // Toggle table selection
        function toggleTableSelection(element, tableId) {
            element.classList.toggle('selected');
        }

        // Update table recommendation based on group size and selected tables
        function updateTableRecommendation() {
            const groupSize = parseInt(document.getElementById('groupSize').value);
            const currentTime = document.getElementById('availableTime').value || '19:00';
            const currentDuration = parseInt(document.getElementById('duration').value) || 120;
            
            // Get currently available tables, excluding current reservation
            const availableTablesNow = calculateTableAvailability(currentTime, currentDuration, currentReservationId);
            
            const selectedTables = Array.from(document.querySelectorAll('.table-option.selected'))
                .map(el => {
                    const tableName = el.querySelector('.table-name').textContent;
                    const table = availableTablesNow.find(t => t.name === tableName);
                    return table;
                })
                .filter(table => table);

            const totalCapacity = selectedTables.reduce((sum, table) => sum + table.capacity, 0);
            const recommendationDiv = document.getElementById('tableRecommendation');
            
            let recommendation = '';
            let icon = '';
            let className = '';

            if (selectedTables.length === 0) {
                recommendation = 'Bitte w√§hlen Sie mindestens einen Tisch aus.';
                icon = '‚ö†Ô∏è';
                className = 'error';
            } else if (totalCapacity < groupSize) {
                const needed = groupSize - totalCapacity;
                recommendation = `Zu wenig Pl√§tze! Noch ${needed} Person${needed > 1 ? 'en' : ''} zu wenig. F√ºgen Sie weitere Tische hinzu.`;
                icon = '‚ùå';
                className = 'error';
            } else if (totalCapacity === groupSize) {
                recommendation = 'Perfekt! Die Tischkapazit√§t passt genau zur Gruppengr√∂√üe.';
                icon = '‚úÖ';
                className = 'perfect';
            } else if (totalCapacity <= groupSize + 2) {
                recommendation = 'Gut! Leicht mehr Kapazit√§t als n√∂tig, aber noch im akzeptablen Bereich.';
                icon = 'üëç';
                className = 'warning';
            } else {
                const excess = totalCapacity - groupSize;
                recommendation = `Zu viel Kapazit√§t! ${excess} Person${excess > 1 ? 'en' : ''} zu viel. Entfernen Sie einen Tisch oder w√§hlen Sie kleinere Tische.`;
                icon = '‚ö†Ô∏è';
                className = 'warning';
            }

            recommendationDiv.innerHTML = `
                <span class="recommendation-icon">${icon}</span>
                <span class="recommendation-text">${recommendation}</span>
            `;
            recommendationDiv.className = `table-recommendation ${className}`;
        }

        // Close reservation modal
        function closeReservationModal() {
            document.getElementById('reservationDetailModal').style.display = 'none';
            currentReservationId = null;
        }

        // Save reservation
        function saveReservation() {
            if (currentReservationId) {
                const reservation = reservationsData.find(r => r.id === currentReservationId);
                if (reservation) {
                    // Update reservation data
                    reservation.date = document.getElementById('reservationDate').value;
                    reservation.guests = parseInt(document.getElementById('groupSize').value);
                    reservation.duration = parseInt(document.getElementById('duration').value);
                    reservation.time = document.getElementById('availableTime').value;
                    reservation.guestName = document.getElementById('guestName').value;
                    reservation.phone = document.getElementById('guestPhone').value;
                    reservation.email = document.getElementById('guestEmail').value;
                    reservation.comment = document.getElementById('reservationComment').value;
                    
                    // Get selected tables
                    const selectedTables = Array.from(document.querySelectorAll('.table-option.selected'))
                        .map(el => el.querySelector('.table-name').textContent);
                    reservation.tables = selectedTables.join(', ');
                    
                    // Re-render the table
                    renderReservations();
                }
            }
            closeReservationModal();
        }

        // Cancel reservation
        function cancelReservation() {
            if (currentReservationId && confirm('M√∂chten Sie diese Reservierung wirklich stornieren?')) {
                const reservation = reservationsData.find(r => r.id === currentReservationId);
                if (reservation) {
                    reservation.status = 'cancelled';
                    renderReservations();
                }
                closeReservationModal();
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const commentModal = document.getElementById('commentModal');
            const reservationModal = document.getElementById('reservationDetailModal');
            const datePickerDropdown = document.getElementById('datePickerDropdown');
            const calendarBtn = document.querySelector('.calendar-btn-modern');
            
            if (event.target === commentModal) {
                closeModal();
            }
            if (event.target === reservationModal) {
                closeReservationModal();
            }
            // Close date picker if clicking outside
            if (datePickerDropdown && datePickerDropdown.style.display === 'block' && 
                !datePickerDropdown.contains(event.target) && 
                !calendarBtn.contains(event.target)) {
                closeDatePicker();
            }
        }

        // Open date picker
        function openDatePicker() {
            const dateInput = document.getElementById('reservationDate');
            dateInput.focus();
            dateInput.showPicker();
        }

        // Toggle date picker dropdown
        function toggleDatePicker() {
            const dropdown = document.getElementById('datePickerDropdown');
            if (dropdown.style.display === 'none' || dropdown.style.display === '') {
                showDatePicker();
            } else {
                closeDatePicker();
            }
        }

        // Show date picker
        function showDatePicker() {
            const dropdown = document.getElementById('datePickerDropdown');
            dropdown.style.display = 'block';
            renderDatePicker();
        }

        // Close date picker
        function closeDatePicker() {
            const dropdown = document.getElementById('datePickerDropdown');
            dropdown.style.display = 'none';
        }

        // Render date picker calendar
        function renderDatePicker() {
            const calendar = document.getElementById('datePickerCalendar');
            const monthYear = document.getElementById('currentMonthYear');
            
            // Set month/year display
            const monthNames = ['Januar', 'Februar', 'M√§rz', 'April', 'Mai', 'Juni',
                               'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
            monthYear.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            // Clear calendar
            calendar.innerHTML = '';
            
            // Add day headers
            const dayHeaders = ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'date-picker-day-header';
                header.textContent = day;
                calendar.appendChild(header);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            // Generate calendar days
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('button');
                dayElement.className = 'date-picker-day';
                dayElement.textContent = date.getDate();
                
                // Add classes for styling
                if (date.getMonth() !== currentDate.getMonth()) {
                    dayElement.classList.add('other-month');
                }
                
                const today = new Date();
                if (date.toDateString() === today.toDateString()) {
                    dayElement.classList.add('today');
                }
                
                if (date.toDateString() === currentDate.toDateString()) {
                    dayElement.classList.add('selected');
                }
                
                // Add click event
                dayElement.onclick = () => selectDate(date);
                
                calendar.appendChild(dayElement);
            }
        }

        // Select a date
        function selectDate(date) {
            currentDate = new Date(date);
            updateDateDisplay();
            renderReservations();
            updateStats();
            closeDatePicker();
        }

        // Change month
        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            renderDatePicker();
        }

        // Go to today
        function goToToday() {
            currentDate = new Date();
            updateDateDisplay();
            renderReservations();
            updateStats();
            closeDatePicker();
        }

        // Open add reservation modal
        function openAddReservation() {
            // Reset form for new reservation
            currentReservationId = null;
            
            // Set default values
            document.getElementById('reservationDate').value = currentDate.toISOString().split('T')[0];
            document.getElementById('groupSize').value = 2;
            document.getElementById('duration').value = 120;
            document.getElementById('availableTime').value = '19:00';
            document.getElementById('guestName').value = '';
            document.getElementById('guestPhone').value = '';
            document.getElementById('guestEmail').value = '';
            document.getElementById('reservationComment').value = '';
            
            // Clear table selections
            populateTables('');
            
            // Show modal
            document.getElementById('reservationDetailModal').style.display = 'block';
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>
